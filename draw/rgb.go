package draw

// RGB to colormap conversion tables
// These support the Plan 9 CMAP8 colormap

// cmap2rgb converts a CMAP8 index to RGB values.
func Cmap2rgb(c int) (r, g, b int) {
	if c < 0 || c > 255 {
		return 0, 0, 0
	}
	return int(cmap2rgb[c][0]), int(cmap2rgb[c][1]), int(cmap2rgb[c][2])
}

// rgb2cmap finds the closest CMAP8 index for an RGB color.
func Rgb2cmap(r, g, b int) int {
	// Clamp values
	if r < 0 {
		r = 0
	}
	if r > 255 {
		r = 255
	}
	if g < 0 {
		g = 0
	}
	if g > 255 {
		g = 255
	}
	if b < 0 {
		b = 0
	}
	if b > 255 {
		b = 255
	}

	// Find closest match
	best := 0
	bestDist := 256 * 256 * 3
	for i := 0; i < 256; i++ {
		dr := r - int(cmap2rgb[i][0])
		dg := g - int(cmap2rgb[i][1])
		db := b - int(cmap2rgb[i][2])
		dist := dr*dr + dg*dg + db*db
		if dist < bestDist {
			bestDist = dist
			best = i
		}
	}
	return best
}

// Cmap2rgba converts a CMAP8 index to RGBA.
func Cmap2rgba(c int) uint32 {
	r, g, b := Cmap2rgb(c)
	return uint32(r)<<24 | uint32(g)<<16 | uint32(b)<<8 | 0xFF
}

// Rgba2cmap converts RGBA to the closest CMAP8 index.
func Rgba2cmap(rgba uint32) int {
	r := int((rgba >> 24) & 0xFF)
	g := int((rgba >> 16) & 0xFF)
	b := int((rgba >> 8) & 0xFF)
	return Rgb2cmap(r, g, b)
}

// Plan 9 CMAP8 colormap (256 entries)
// This is the standard Plan 9 color lookup table
var cmap2rgb = [256][3]byte{
	{0xFF, 0xFF, 0xFF}, {0xFF, 0xFF, 0xAA}, {0xFF, 0xFF, 0x55}, {0xFF, 0xFF, 0x00},
	{0xFF, 0xAA, 0xFF}, {0xFF, 0xAA, 0xAA}, {0xFF, 0xAA, 0x55}, {0xFF, 0xAA, 0x00},
	{0xFF, 0x55, 0xFF}, {0xFF, 0x55, 0xAA}, {0xFF, 0x55, 0x55}, {0xFF, 0x55, 0x00},
	{0xFF, 0x00, 0xFF}, {0xFF, 0x00, 0xAA}, {0xFF, 0x00, 0x55}, {0xFF, 0x00, 0x00},
	{0xEE, 0xEE, 0xEE}, {0xDD, 0xDD, 0xDD}, {0xCC, 0xCC, 0xCC}, {0xBB, 0xBB, 0xBB},
	{0xAA, 0xAA, 0xAA}, {0x99, 0x99, 0x99}, {0x88, 0x88, 0x88}, {0x77, 0x77, 0x77},
	{0x66, 0x66, 0x66}, {0x55, 0x55, 0x55}, {0x44, 0x44, 0x44}, {0x33, 0x33, 0x33},
	{0x22, 0x22, 0x22}, {0x11, 0x11, 0x11}, {0x00, 0x00, 0x00}, {0x00, 0x55, 0x00},
	{0x00, 0xAA, 0x00}, {0x00, 0xFF, 0x00}, {0x00, 0x00, 0x55}, {0x00, 0x55, 0x55},
	{0x00, 0xAA, 0x55}, {0x00, 0xFF, 0x55}, {0x00, 0x00, 0xAA}, {0x00, 0x55, 0xAA},
	{0x00, 0xAA, 0xAA}, {0x00, 0xFF, 0xAA}, {0x00, 0x00, 0xFF}, {0x00, 0x55, 0xFF},
	{0x00, 0xAA, 0xFF}, {0x00, 0xFF, 0xFF}, {0x55, 0x00, 0x00}, {0x55, 0x55, 0x00},
	{0x55, 0xAA, 0x00}, {0x55, 0xFF, 0x00}, {0x55, 0x00, 0x55}, {0x55, 0x55, 0x55},
	{0x55, 0xAA, 0x55}, {0x55, 0xFF, 0x55}, {0x55, 0x00, 0xAA}, {0x55, 0x55, 0xAA},
	{0x55, 0xAA, 0xAA}, {0x55, 0xFF, 0xAA}, {0x55, 0x00, 0xFF}, {0x55, 0x55, 0xFF},
	{0x55, 0xAA, 0xFF}, {0x55, 0xFF, 0xFF}, {0xAA, 0x00, 0x00}, {0xAA, 0x55, 0x00},
	{0xAA, 0xAA, 0x00}, {0xAA, 0xFF, 0x00}, {0xAA, 0x00, 0x55}, {0xAA, 0x55, 0x55},
	{0xAA, 0xAA, 0x55}, {0xAA, 0xFF, 0x55}, {0xAA, 0x00, 0xAA}, {0xAA, 0x55, 0xAA},
	{0xAA, 0xAA, 0xAA}, {0xAA, 0xFF, 0xAA}, {0xAA, 0x00, 0xFF}, {0xAA, 0x55, 0xFF},
	{0xAA, 0xAA, 0xFF}, {0xAA, 0xFF, 0xFF}, {0xFF, 0x55, 0x00}, {0xFF, 0xAA, 0x00},
	{0xFF, 0x00, 0x55}, {0xFF, 0x55, 0x55}, {0xFF, 0xAA, 0x55}, {0xFF, 0xFF, 0x55},
	{0xFF, 0x00, 0xAA}, {0xFF, 0x55, 0xAA}, {0xFF, 0xAA, 0xAA}, {0xFF, 0xFF, 0xAA},
	{0xFF, 0x00, 0xFF}, {0xFF, 0x55, 0xFF}, {0xFF, 0xAA, 0xFF}, {0xFF, 0xFF, 0xFF},
	{0x00, 0x00, 0x00}, {0x00, 0x00, 0x24}, {0x00, 0x00, 0x49}, {0x00, 0x00, 0x6D},
	{0x00, 0x00, 0x92}, {0x00, 0x00, 0xB6}, {0x00, 0x00, 0xDB}, {0x00, 0x00, 0xFF},
	{0x00, 0x24, 0x00}, {0x00, 0x24, 0x24}, {0x00, 0x24, 0x49}, {0x00, 0x24, 0x6D},
	{0x00, 0x24, 0x92}, {0x00, 0x24, 0xB6}, {0x00, 0x24, 0xDB}, {0x00, 0x24, 0xFF},
	{0x00, 0x49, 0x00}, {0x00, 0x49, 0x24}, {0x00, 0x49, 0x49}, {0x00, 0x49, 0x6D},
	{0x00, 0x49, 0x92}, {0x00, 0x49, 0xB6}, {0x00, 0x49, 0xDB}, {0x00, 0x49, 0xFF},
	{0x00, 0x6D, 0x00}, {0x00, 0x6D, 0x24}, {0x00, 0x6D, 0x49}, {0x00, 0x6D, 0x6D},
	{0x00, 0x6D, 0x92}, {0x00, 0x6D, 0xB6}, {0x00, 0x6D, 0xDB}, {0x00, 0x6D, 0xFF},
	{0x00, 0x92, 0x00}, {0x00, 0x92, 0x24}, {0x00, 0x92, 0x49}, {0x00, 0x92, 0x6D},
	{0x00, 0x92, 0x92}, {0x00, 0x92, 0xB6}, {0x00, 0x92, 0xDB}, {0x00, 0x92, 0xFF},
	{0x00, 0xB6, 0x00}, {0x00, 0xB6, 0x24}, {0x00, 0xB6, 0x49}, {0x00, 0xB6, 0x6D},
	{0x00, 0xB6, 0x92}, {0x00, 0xB6, 0xB6}, {0x00, 0xB6, 0xDB}, {0x00, 0xB6, 0xFF},
	{0x00, 0xDB, 0x00}, {0x00, 0xDB, 0x24}, {0x00, 0xDB, 0x49}, {0x00, 0xDB, 0x6D},
	{0x00, 0xDB, 0x92}, {0x00, 0xDB, 0xB6}, {0x00, 0xDB, 0xDB}, {0x00, 0xDB, 0xFF},
	{0x00, 0xFF, 0x00}, {0x00, 0xFF, 0x24}, {0x00, 0xFF, 0x49}, {0x00, 0xFF, 0x6D},
	{0x00, 0xFF, 0x92}, {0x00, 0xFF, 0xB6}, {0x00, 0xFF, 0xDB}, {0x00, 0xFF, 0xFF},
	{0x24, 0x00, 0x00}, {0x24, 0x00, 0x24}, {0x24, 0x00, 0x49}, {0x24, 0x00, 0x6D},
	{0x24, 0x00, 0x92}, {0x24, 0x00, 0xB6}, {0x24, 0x00, 0xDB}, {0x24, 0x00, 0xFF},
	{0x24, 0x24, 0x00}, {0x24, 0x24, 0x24}, {0x24, 0x24, 0x49}, {0x24, 0x24, 0x6D},
	{0x24, 0x24, 0x92}, {0x24, 0x24, 0xB6}, {0x24, 0x24, 0xDB}, {0x24, 0x24, 0xFF},
	{0x24, 0x49, 0x00}, {0x24, 0x49, 0x24}, {0x24, 0x49, 0x49}, {0x24, 0x49, 0x6D},
	{0x24, 0x49, 0x92}, {0x24, 0x49, 0xB6}, {0x24, 0x49, 0xDB}, {0x24, 0x49, 0xFF},
	{0x24, 0x6D, 0x00}, {0x24, 0x6D, 0x24}, {0x24, 0x6D, 0x49}, {0x24, 0x6D, 0x6D},
	{0x24, 0x6D, 0x92}, {0x24, 0x6D, 0xB6}, {0x24, 0x6D, 0xDB}, {0x24, 0x6D, 0xFF},
	{0x24, 0x92, 0x00}, {0x24, 0x92, 0x24}, {0x24, 0x92, 0x49}, {0x24, 0x92, 0x6D},
	{0x24, 0x92, 0x92}, {0x24, 0x92, 0xB6}, {0x24, 0x92, 0xDB}, {0x24, 0x92, 0xFF},
	{0x24, 0xB6, 0x00}, {0x24, 0xB6, 0x24}, {0x24, 0xB6, 0x49}, {0x24, 0xB6, 0x6D},
	{0x24, 0xB6, 0x92}, {0x24, 0xB6, 0xB6}, {0x24, 0xB6, 0xDB}, {0x24, 0xB6, 0xFF},
	{0x24, 0xDB, 0x00}, {0x24, 0xDB, 0x24}, {0x24, 0xDB, 0x49}, {0x24, 0xDB, 0x6D},
	{0x24, 0xDB, 0x92}, {0x24, 0xDB, 0xB6}, {0x24, 0xDB, 0xDB}, {0x24, 0xDB, 0xFF},
	{0x24, 0xFF, 0x00}, {0x24, 0xFF, 0x24}, {0x24, 0xFF, 0x49}, {0x24, 0xFF, 0x6D},
	{0x24, 0xFF, 0x92}, {0x24, 0xFF, 0xB6}, {0x24, 0xFF, 0xDB}, {0x24, 0xFF, 0xFF},
	{0x49, 0x00, 0x00}, {0x49, 0x00, 0x24}, {0x49, 0x00, 0x49}, {0x49, 0x00, 0x6D},
	{0x49, 0x00, 0x92}, {0x49, 0x00, 0xB6}, {0x49, 0x00, 0xDB}, {0x49, 0x00, 0xFF},
	{0x49, 0x24, 0x00}, {0x49, 0x24, 0x24}, {0x49, 0x24, 0x49}, {0x49, 0x24, 0x6D},
	{0x49, 0x24, 0x92}, {0x49, 0x24, 0xB6}, {0x49, 0x24, 0xDB}, {0x49, 0x24, 0xFF},
	{0x49, 0x49, 0x00}, {0x49, 0x49, 0x24}, {0x49, 0x49, 0x49}, {0x49, 0x49, 0x6D},
	{0x49, 0x49, 0x92}, {0x49, 0x49, 0xB6}, {0x49, 0x49, 0xDB}, {0x49, 0x49, 0xFF},
	{0x49, 0x6D, 0x00}, {0x49, 0x6D, 0x24}, {0x49, 0x6D, 0x49}, {0x49, 0x6D, 0x6D},
	{0x49, 0x6D, 0x92}, {0x49, 0x6D, 0xB6}, {0x49, 0x6D, 0xDB}, {0x49, 0x6D, 0xFF},
}
